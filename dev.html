<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Developer Docs &mdash; airspeed velocity 0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-3.2.0/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-3.2.0/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.2.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="_static/swallow.ico"/>
    <link rel="top" title="airspeed velocity 0.1 documentation" href="index.html" />
    <link rel="prev" title="Commands" href="commands.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body>
  
  <a href="https://github.com/spacetelescope/asv"
     class="visible-desktop"><img
    style="position: absolute; top: 40px; right: 0; border: 0;"
    src="https://s3.amazonaws.com/github/ribbons/forkme_right_white_ffffff.png"
    alt="Fork me on GitHub"></a>


  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">
          airspeed velocity</a>
        <span class="navbar-text navbar-version pull-left"><b>0.1</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installing.html">Installing airspeed velocity</a></li>
<li class="toctree-l1"><a class="reference internal" href="using.html">Using airspeed velocity</a></li>
<li class="toctree-l1"><a class="reference internal" href="writing_benchmarks.html">Writing benchmarks</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">Reference</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Developer Docs</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Developer Docs</a><ul>
<li><a class="reference internal" href="#benchmark-suite-layout">Benchmark suite layout</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="commands.html" title="Previous Chapter: Commands"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Commands</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      
  <div class="section" id="developer-docs">
<h1>Developer Docs<a class="headerlink" href="#developer-docs" title="Permalink to this headline">¶</a></h1>
<p>This section describes some things that may be of interest to
developers of <tt class="docutils literal"><span class="pre">asv</span></tt>.</p>
<div class="section" id="benchmark-suite-layout">
<h2>Benchmark suite layout<a class="headerlink" href="#benchmark-suite-layout" title="Permalink to this headline">¶</a></h2>
<p>A benchmark suite directory has the following layout.  The
<tt class="docutils literal"><span class="pre">$</span></tt>-prefixed variables refer to values in the <tt class="docutils literal"><span class="pre">asv.conf.json</span></tt> file.</p>
<ul>
<li><p class="first"><tt class="docutils literal"><span class="pre">asv.conf.json</span></tt>: The configuration file.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">$benchmark_dir</span></tt>: Contains the benchmark code, created by the
user.  Each subdirectory needs an <tt class="docutils literal"><span class="pre">__init__.py</span></tt>.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">$project/</span></tt>: A clone of the project being benchmarked.
Information about the history is grabbed from here, but the actual
building happens in the environment-specific clones described below.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">$env_dir/</span></tt>: Contains the environments used for building and
benchmarking.  There is one environment in here for each specific
combination of Python version and library dependency.  Generally,
the dependencies are only installed once, and then reused on
subsequent runs of <tt class="docutils literal"><span class="pre">asv</span></tt>, but the project itself needs to be
rebuilt for each commit being benchmarked.</p>
<ul>
<li><p class="first"><tt class="docutils literal"><span class="pre">$ENVIRONMENT_HASH/</span></tt>: The directory name of each environment is
the md5hash of the list of dependencies and the Python version.
This is not very user friendly, but this keeps the filename within
reasonable limits.</p>
<ul>
<li><p class="first"><tt class="docutils literal"><span class="pre">asv-env-info.json</span></tt>: Contains information about the
environment, mainly the Python version and dependencies used.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">project/</span></tt>: An environment-specific clone of the project
repository.  Each environment has its own clone so that builds
can be run in parallel without fear of clobbering (particularly
for projects that generate source files outside of the
<tt class="docutils literal"><span class="pre">build/</span></tt> directory.  These clones are created from the main
<tt class="docutils literal"><span class="pre">$project/</span></tt> directory using the <tt class="docutils literal"><span class="pre">--shared</span></tt> option to <tt class="docutils literal"><span class="pre">git</span>
<span class="pre">clone</span></tt> so that the repository history is stored in one place to
save on disk space.</p>
<p>The project is built in this directory with the standard
<tt class="docutils literal"><span class="pre">distutils</span></tt> <tt class="docutils literal"><span class="pre">python</span> <span class="pre">setup.py</span> <span class="pre">build</span></tt> command.  This means
repeated builds happen in the same place and <a class="reference external" href="https://ccache.samba.org">ccache</a> is able to cache and reuse many of
the build products.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">wheels/</span></tt>: If <tt class="docutils literal"><span class="pre">wheel_cache_size</span></tt> in <tt class="docutils literal"><span class="pre">asv.conf.json</span></tt> is set
to something other than 0, this contains <a class="reference external" href="https://pypi.python.org/pypi/wheel">Wheels</a> of the last N project
builds for this environment.  In this way, if a build for a
particular commit has already been performed and cached, it can
be restored much more quickly.  Each subdirectory is a commit
hash, containing one <tt class="docutils literal"><span class="pre">.whl</span></tt> file and a timestamp.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">usr/</span></tt>, <tt class="docutils literal"><span class="pre">lib/</span></tt>, <tt class="docutils literal"><span class="pre">bin/</span></tt> etc.: These are the virtualenv or
Conda environment directories that we install the project into
and then run benchmarks from.</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">$results_dir/</span></tt>: This is the &#8220;database&#8221; of results from benchmark
runs.</p>
<ul>
<li><p class="first"><tt class="docutils literal"><span class="pre">benchmarks.json</span></tt>: Contains metadata about all of the
benchmarks in the suite.  It is a dictionary from benchmark
names (a fully-qualified dot-separated path) to dictionaries
containing information about that benchmark.  Useful keys
include:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">code</span></tt>: The Python code of the benchmark</li>
<li><tt class="docutils literal"><span class="pre">params</span></tt>: List of lists describing parameter values of a
parameterized benchmark. If benchmark is not parameterized, an
empty list. Otherwise, the n-th entry of the list is a list of
the Python <tt class="docutils literal"><span class="pre">repr()</span></tt> strings for the values the n-th parameter
should loop over.</li>
<li><tt class="docutils literal"><span class="pre">param_names</span></tt>: Names for parameters for a parameterized
benchmark. Must be of the same length as the <tt class="docutils literal"><span class="pre">params</span></tt> list.</li>
</ul>
<p>Other keys are specific to the kind of benchmark, and correspond
to <a class="reference internal" href="writing_benchmarks.html#benchmark-attributes"><em>Benchmark attributes</em></a>.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">MACHINE/</span></tt>: Within the results directory is a directory for each
machine.  Putting results from different machines in separate
directories makes the results trivial to merge, which is useful
when benchmarking across different platforms or architectures.</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">HASH-pythonX.X-depA-depB.json</span></tt>: Each JSON file within a
particular machine represents a run of benchmarks for a
particular project commit in a particular environment.  Useful
keys include:<ul>
<li><tt class="docutils literal"><span class="pre">commit_hash</span></tt>: The project commit that the benchmarks were
run on.</li>
<li><tt class="docutils literal"><span class="pre">date</span></tt>: A Javascript date stamp of the date of the commit
(not when the benchmarks were run).</li>
<li><tt class="docutils literal"><span class="pre">params</span></tt>: Information about the machine the benchmarks were
run on.</li>
<li><tt class="docutils literal"><span class="pre">results</span></tt>: A dictionary from benchmark names to benchmark
results.<ul>
<li>If non-parameterized benchmark, the result is a single value</li>
<li>For parameterized benchmarks, the result is a dictionary
with keys <tt class="docutils literal"><span class="pre">params</span></tt> and <tt class="docutils literal"><span class="pre">result</span></tt>. The <tt class="docutils literal"><span class="pre">params</span></tt> value
contains a copy of the parameter values of the benchmark, as
described above. If the user has modified the benchmark
after the benchmark was run, these may differ from the
current values. The <tt class="docutils literal"><span class="pre">result</span></tt> value is a list of
results. Each entry corresponds to one combination of the
parameter values. The n-th entry in the list corresponds to
the parameter combination <tt class="docutils literal"><span class="pre">itertools.product(*params)[n]</span></tt>,
i.e., the results appear in cartesian product order, with
the last parameters varying fastest.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">$html_dir/</span></tt>: The output of <tt class="docutils literal"><span class="pre">asv</span> <span class="pre">publish</span></tt>, that turns the raw
results in <tt class="docutils literal"><span class="pre">$results_dir/</span></tt> into something viewable in a web
browser.  It is an important feature of <tt class="docutils literal"><span class="pre">asv</span></tt> that the results can
be shared on a static web server, so there is no server side
component, and the result data is accessed through AJAX calls from
Javascript.  Most of the files at the root of <tt class="docutils literal"><span class="pre">$html_dir/</span></tt> are
completely static and are just copied verbatim from <tt class="docutils literal"><span class="pre">asv/www/</span></tt> in
the source tree.</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">index.json</span></tt>: Contains an index into the benchmark data,
describing what is available.  Important keys include:<ul>
<li><tt class="docutils literal"><span class="pre">benchmarks</span></tt>: A dictionary of benchmarks.  At the moment, this
is identical to the content in <tt class="docutils literal"><span class="pre">$results_dir/benchmarks.json</span></tt>.</li>
<li><tt class="docutils literal"><span class="pre">date_to_hash</span></tt>: A dictionary mapping Javascript date stamps to
commit hashes.  This allows the x-scale of a plot to be scaled
by date.</li>
<li><tt class="docutils literal"><span class="pre">machines</span></tt>: Describes the machines used for testing.</li>
<li><tt class="docutils literal"><span class="pre">params</span></tt>: A dictionary of parameters against which benchmark
results can be selected.  Each entry is a list of valid values
for that parameter.</li>
<li><tt class="docutils literal"><span class="pre">tags</span></tt>: A dictionary of git tags and their dates, so this
information can be displayed in the plot.</li>
</ul>
</li>
<li><tt class="docutils literal"><span class="pre">graphs/</span></tt>: This is a nested tree of directories where each level
is a parameter from the <tt class="docutils literal"><span class="pre">params</span></tt> dictionary, in asciibetical
order.  The web interface, given a set of parameters that are set,
get easily grab the associated graph.<ul>
<li><tt class="docutils literal"><span class="pre">BENCHMARK_NAME.json</span></tt>: At the leaves of this tree are the
actual benchmark graphs.  It contains a list of pairs, where
each pair is of the form <tt class="docutils literal"><span class="pre">(timestamp,</span> <span class="pre">result_value)</span></tt>.  For
parameterized benchmarks, <tt class="docutils literal"><span class="pre">result_value</span></tt> is a list of results,
corresponding to <tt class="docutils literal"><span class="pre">itertools.product</span></tt> iteration over the
parameter combinations, similarly as in the result files. For
non-parameterized benchmarks, it is directly the result.</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2013, Michael Droettboom.<br/>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2.3.<br/>
    </p>
  </div>
</footer>
  </body>
</html>